#!/usr/bin/awk -f

BEGIN {
  FS = "\t";
  printf("tdid,mac\n");
}
NR >= 2 {
  orderid = $6;
  ip = $5;
  amount = $7;

  tdid = $1;
  mac = $3;

  if (orderid != "" && ip ~ /^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])$/) {
    if ((mac ~ /^[A-F0-9]{2}(:[A-F0-9]{2}){5}$/ || mac != "02:00:00:00:00:00") && mac != "") {
      printf("%s,%s\n", tdid, mac);
    }
  }
}
