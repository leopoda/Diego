#!/usr/bin/awk -f

BEGIN {
  FS = "\t";
  APPKEY_IOS = "5409a87f301e4c438149be1176517583";
  printf("tdid,idfa\n");
}
NR >= 2 {
  orderid = $6;
  ip = $5;
  amount = $7;

  tdid = $1;
  idfa = $2;
  appkey = $9;

  if (orderid != "" && ip ~ /^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])$/) {
    if (appkey == APPKEY_IOS && idfa != "") {
      printf("%s,%s\n", tdid, idfa);
    }
  }
}

